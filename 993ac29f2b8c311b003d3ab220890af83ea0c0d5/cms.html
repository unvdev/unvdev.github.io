<div id="loaded-page">
</div>
<input class="target-page" style="width: 300px; height: 20px;" type="text">
<button class="load-page">Grab Page Code</button>
<script>
    let paramString = window.location.search.split('?')[1];
    let queryString = new URLSearchParams(paramString);
    let nva = parseInt(queryString.get('nva'));
    let now = new Date().getTime();
    if (Number.isNaN(nva) || now > nva) {
        window.location = '/cms_login';
    }
</script>
<script>
    const targetPageInput = document.querySelector(".target-page");
    const loadPage = document.querySelector(".load-page");
    const loadedPage = document.querySelector("#loaded-page");

    loadPage.addEventListener("click", function() {
        const targetPage = targetPageInput.value;

        if (!targetPage) {
            console.error("Please enter a page path.");
            return;
        }

        async function fetchOtherPageHTML(path) {
            try {
                const response = await fetch(path);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const htmlString = await response.text();
                return htmlString;
            } catch (error) {
                console.error("Error fetching the page:", error);
                return null;
            }
        }

        fetchOtherPageHTML(targetPage).then(html => {
            if (html) {
                // Clear the existing content
                loadedPage.innerHTML = '';
                
                // Parse the fetched HTML string into a DOM element
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');

                // Load and append CSS
                doc.head.querySelectorAll('link[rel="stylesheet"]').forEach(link => {
                    document.head.appendChild(link);
                });
                doc.head.querySelectorAll('style').forEach(style => {
                    document.head.appendChild(style);
                });

                // Collect all scripts and HTML nodes
                const htmlNodes = [];
                const scripts = [];

                doc.body.childNodes.forEach(node => {
                    if (node.nodeName === 'SCRIPT') {
                        scripts.push(node);
                    } else {
                        htmlNodes.push(node);
                    }
                });

                // Append all HTML nodes at once
                htmlNodes.forEach(node => {
                    loadedPage.appendChild(node);
                });

                // Use a short timeout to ensure the DOM has finished rendering the HTML
                setTimeout(() => {
                    // Now execute the scripts
                    scripts.forEach(script => {
                        const newScript = document.createElement('script');
                        if (script.src) {
                            newScript.src = script.src;
                        } else {
                            newScript.textContent = script.textContent;
                        }
                        loadedPage.appendChild(newScript);
                    });
                }, 50); // 50ms delay is usually sufficient
            }
        });
    });
</script>
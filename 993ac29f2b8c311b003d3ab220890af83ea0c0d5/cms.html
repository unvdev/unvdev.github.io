<div id="loaded-page">
</div>
<input class="target-page" style="width: 300px; height: 20px;" type="text">
<button class="load-page">Grab Page Code</button>
<script>
    let paramString = window.location.search.split('?')[1];
    let queryString = new URLSearchParams(paramString);
    let nva = parseInt(queryString.get('nva'));
    let now = new Date().getTime();
    if (Number.isNaN(nva) || now > nva) {
        window.location = '/cms_login';
    }
</script>
<script>
    const targetPageInput = document.querySelector(".target-page");
    const loadPage = document.querySelector(".load-page");
    const loadedPage = document.querySelector("#loaded-page");

    loadPage.addEventListener("click", function() {
        const targetPage = targetPageInput.value;

        if (!targetPage) {
            console.error("Please enter a page path.");
            return;
        }

        async function fetchOtherPageHTML(path) {
            try {
                const response = await fetch(path);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const htmlString = await response.text();
                return htmlString;
            } catch (error) {
                console.error("Error fetching the page:", error);
                return null;
            }
        }

        fetchOtherPageHTML(targetPage).then(html => {
            if (html) {
                // Clear the existing content
                loadedPage.innerHTML = '';
                
                // Parse the fetched HTML string into a DOM element
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');

                // Load and append CSS
                doc.head.querySelectorAll('link[rel="stylesheet"]').forEach(link => {
                    document.head.appendChild(link);
                });
                doc.head.querySelectorAll('style').forEach(style => {
                    document.head.appendChild(style);
                });

                // Remove scripts from the fetched content to prevent immediate execution
                const scripts = doc.body.querySelectorAll('script');
                scripts.forEach(script => script.remove());

                // Append the modified body content to the loaded-page div
                doc.body.childNodes.forEach(node => {
                    loadedPage.appendChild(node);
                });

                // Now execute the scripts AFTER the HTML elements are in the DOM
                scripts.forEach(script => {
                    const newScript = document.createElement('script');
                    if (script.src) {
                        newScript.src = script.src;
                    } else {
                        newScript.textContent = script.textContent;
                    }
                    loadedPage.appendChild(newScript);
                });
            }
        });
    });
</script>